var e;!function(e){e.TOKEN_KEYS="adal.token.keys",e.ACCESS_TOKEN_KEY="adal.access.token.key",e.EXPIRATION_KEY="adal.expiration.key",e.STATE_LOGIN="adal.state.login",e.STATE_RENEW="adal.state.renew",e.NONCE_IDTOKEN="adal.nonce.idtoken",e.SESSION_STATE="adal.session.state",e.USERNAME="adal.username",e.IDTOKEN="adal.idtoken",e.ERROR="adal.error",e.ERROR_DESCRIPTION="adal.error.description",e.LOGIN_REQUEST="adal.login.request",e.LOGIN_ERROR="adal.login.error",e.RENEW_STATUS="adal.token.renew.status"}(e||(e={}));const t=(()=>{function e(e){const t=window[e];return!!t&&(t.setItem("__test__","__test__"),"__test__"===t.getItem("__test__")&&(t.removeItem("__test__"),!t.getItem("__test__")))}return e("localStorage")?localStorage:e("sessionStorage")?sessionStorage:{getItem(){},setItem(){}}})();var n,r,o,a;function i(t){if(window._adalInstance)return window._adalInstance;let n,i;t=c(t);let s={},k=!1,C=!1,v=[],y=[],A={},P={},U=r.LOGIN;function x(t,n,r,o,a){u(e.ERROR,r),u(e.ERROR_DESCRIPTION,o),u(e.LOGIN_ERROR,a),n&&s[n]&&(s[n]=null),k=!1,C=!1,t&&t(o,null,r)}function L(e,n,r){var o=function(e,t,n,r){try{const t=window.innerWidth/2-241.5+window.screenX,n=window.innerHeight/2-300+window.screenY,r=window.open(e,"login","width=483, height=600, top="+n+", left="+t);return r.focus&&r.focus(),r}catch(e){k=!1,C=!1}}(e),a=r||t.callback;if(!o){var i="Popup Window is null. This can happen if you are using IE";return void x(a,n,"Error opening popup",i,i)}y.push(o);const s=t.redirectUri.split("#")[0];let l=setInterval(()=>{if(!o||o.closed||void 0===o.closed){let e="Popup Window closed by UI action/ Popup Window handle destroyed due to cross zone navigation in IE/Edge";return x(a,n,"Popup Window closed",e,e),void clearInterval(l)}try{let e=o.location;if(-1!=encodeURI(e.href).indexOf(encodeURI(s)))return F(e.hash),clearInterval(l),k=!1,C=!1,y=[],void o.close()}catch(e){}},1)}function W(e,t,n){s[t]=e,P[e]||(P[e]=[]),P[e].push(n),A[e]||(A[e]=(n,r,o,a)=>{s[t]=null;for(var i=0;i<P[e].length;++i)try{P[e][i](n,r,o,a)}catch(o){}P[e]=null,A[e]=null})}function b(n,r,a="token"){let s=X("adalRenewFrame"+n),l=S()+"|"+n;t.state=l,v.push(l);let c=p(Q(a,n),"prompt");a===o.ID_TOKEN&&(i=S(),u(e.NONCE_IDTOKEN,i,!0),c+="&nonce="+d(i)),c+="&prompt=none",c=q(c),W(l,n,r),s.src="about:blank",Y(c,"adalRenewFrame"+n,n)}function D(n,r){let o=X("adalIdTokenFrame"),a=S()+"|"+t.clientId;i=S(),u(e.NONCE_IDTOKEN,i,!0),t.state=a,v.push(a);let s=r||t.clientId,l=p(Q(r=r||"id_token",s),"prompt");l=q(l+"&prompt=none"),l+="&nonce="+d(i),W(a,t.clientId,n),o.src="about:blank",Y(l,"adalIdTokenFrame",t.clientId)}function Y(n,r,o){u(e.RENEW_STATUS+o,a.InProgress),function e(t,n){setTimeout(()=>{const r=X(n);r.src&&"about:blank"!==r.src||(r.src=t,e(t,n))},500)}(n,r),setTimeout(()=>{if(w(e.RENEW_STATUS+o)===a.InProgress){var t=s[o];t&&A[t]&&A[t]("Token renewal operation failed due to timeout",null,"Token Renewal Failed"),u(e.RENEW_STATUS+o,a.Canceled)}},t.loadFrameTimeout)}function G(e){e&&window.location.replace(e)}function q(e){if(!n||!n.profile)return e;if(n.profile.sid&&-1!==e.indexOf("&prompt=none"))E("sid",e)||(e+="&sid="+d(n.profile.sid));else if(n.profile.upn&&(E("login_hint",e)||(e+="&login_hint="+d(n.profile.upn)),!E("domain_hint",e)&&n.profile.upn.indexOf("@")>-1)){var t=n.profile.upn.split("@");e+="&domain_hint="+d(t[t.length-1])}return e}function M(e){const n=function(e){let t=l(e);var n;if(t)try{let e=(n=(n=t.JWSPayload).replace(/-/g,"+").replace(/_/g,"/"),decodeURIComponent(escape(window.atob(n))));return e?JSON.parse(e):void 0}catch(e){}}(e);if(h(n,"aud"))return n.aud.toLowerCase()===t.clientId.toLowerCase()?{userName:n.upn||n.email,profile:n}:void 0}function F(t=window.location.hash){if(!f(t))return;let n,o;const a=y[y.length-1];a&&a.opener&&a.opener._AuthenticationContextInstance?(n=a.opener._adalInstance,o=!0):window.parent&&window.parent._adalInstance&&(n=window.parent._adalInstance);let i,s,l,c=n.getRequestInfo(t);i=o||window.parent!==window?n._callBackMappedToRenewStates[c.stateResponse]:n.config.callback,n.saveTokenFromHash(c),c.requestType===r.RENEW_TOKEN&&window.parent?(s=c.parameters.access_token||c.parameters.id_token,l="access_token"):c.requestType===r.LOGIN&&(s=c.parameters.id_token,l="id_token");try{i&&i(c.parameters.error_description,s,c.parameters.error,l)}catch(e){}window.parent!==window||o||(n.config.navigateToLoginRequestUrl?window.location.href=w(e.LOGIN_REQUEST):window.location.hash="")}let Q=(e,n)=>t.instance+t.tenant+"/oauth2/authorize"+m(e,t,n);function X(e){return document.getElementById(e)||(document.body.insertAdjacentHTML("beforeEnd",`<iframe name="${e}" id="${e}" style="display:none"></iframe>`),window.frames&&window.frames[e])}return window._adalInstance={config:t,login:function(){if(k)return;k=!0;const n=S(),r=window.location.href;t.state=n,i=S(),u(e.LOGIN_REQUEST,r),u(e.LOGIN_ERROR,""),u(e.STATE_LOGIN,n,!0),u(e.NONCE_IDTOKEN,i,!0),u(e.ERROR,""),u(e.ERROR_DESCRIPTION,"");const o=Q("id_token")+"&nonce="+d(i);t.displayCall?t.displayCall(o):t.popUp?(u(e.STATE_LOGIN,""),v.push(n),W(n,t.clientId,t.callback),L(o)):G(o)},logout:function(){let r;if(function(){u(e.LOGIN_REQUEST,""),u(e.SESSION_STATE,""),u(e.STATE_LOGIN,""),u(e.STATE_RENEW,""),v=[],u(e.NONCE_IDTOKEN,""),u(e.IDTOKEN,""),u(e.ERROR,""),u(e.ERROR_DESCRIPTION,""),u(e.LOGIN_ERROR,""),u(e.LOGIN_ERROR,"");var t=w(e.TOKEN_KEYS);if(!g(t)){t=t.split("|");for(var n=0;n<t.length&&""!==t[n];n++)u(e.ACCESS_TOKEN_KEY+t[n],""),u(e.EXPIRATION_KEY+t[n],0)}u(e.TOKEN_KEYS,"")}(),n=null,t.logOutUri)r=t.logOutUri;else{let e="";t.postLogoutRedirectUri&&(e="post_logout_redirect_uri="+d(t.postLogoutRedirectUri)),r=t.instance+t.tenant+"/oauth2/logout?"+e}G(r)},getUser:function(){if(!n){const t=w(e.IDTOKEN);t&&(n=M(t))}return n},registerCallback:W,acquireToken:function(a,i){if(!a){const e="resource is required";return void i(e,null,e)}const l=function(n){if(!_(n))return;const r=w(e.ACCESS_TOKEN_KEY+n),o=w(e.EXPIRATION_KEY+n);if(o&&o>K()+t.expireOffsetSeconds)return r;u(e.ACCESS_TOKEN_KEY+n,""),u(e.EXPIRATION_KEY+n,0)}(a);if(l)i(null,l,null);else if(n||t.extraQueryParameter&&-1!==t.extraQueryParameter.indexOf("login_hint"))s[a]?W(s[a],a,i):(U=r.RENEW_TOKEN,a===t.clientId?n?D(i):D(i,o.ID_TOKEN):n?b(a,i):b(a,i,o.ID_TOKEN));else{const e="User login is required";i(e,null,e)}},acquireTokenPopup:function(e,o,a,i){if(function(e){let r;return e?n?C&&(r="Acquire token interactive is already in progress"):r="User login is required":r="Resource is required",r&&t.callback(r,null,r),!r}(e)){var s=S()+"|"+e;t.state=s,v.push(s),U=r.RENEW_TOKEN;var l=p(Q("token",e),"prompt");if(l+="&prompt=select_account",o&&(l+=o),a){if(-1!==l.indexOf("&claims"))throw new Error("Claims cannot be passed as an extraQueryParameter");l+="&claims="+d(a)}l=q(l),C=!0,W(s,e,i),L(l,e,i)}},getRequestInfo:function(t){const n={valid:!1,parameters:{},stateMatch:!1,stateResponse:"",requestType:r.UNKNOWN},o=O(R(t));if(!o)return n;if(n.parameters=o,h(o,"error_description")||h(o,"access_token")||h(o,"id_token")){if(n.valid=!0,!h(o,"state"))return n;if(n.stateResponse=o.state,function(t){const n=w(e.STATE_LOGIN);if(n)for(const e of n.split("||"))if(e===t.stateResponse)return t.requestType=r.LOGIN,t.stateMatch=!0,!0;const o=w(e.STATE_RENEW);if(o)for(const e of o.split("||"))if(e===t.stateResponse)return t.requestType=r.RENEW_TOKEN,t.stateMatch=!0,!0;return!1}(n))return n;if(!n.stateMatch&&window.parent){n.requestType=U;for(const e of v)if(e===n.stateResponse){n.stateMatch=!0;break}}}return n},saveTokenFromHash:function(o){u(e.ERROR,""),u(e.ERROR_DESCRIPTION,"");let i=N(o.stateResponse);if(h(o.parameters,"error_description"))u(e.ERROR,o.parameters.error),u(e.ERROR_DESCRIPTION,o.parameters.error_description),o.requestType===r.LOGIN&&(k=!1,u(e.LOGIN_ERROR,o.parameters.error_description));else if(o.stateMatch){let r;if(h(o.parameters,"session_state")&&u(e.SESSION_STATE,o.parameters.session_state),h(o.parameters,"access_token")&&(_(i)||(r=w(e.TOKEN_KEYS)||"",u(e.TOKEN_KEYS,r+i+"|")),u(e.ACCESS_TOKEN_KEY+i,o.parameters.access_token),u(e.EXPIRATION_KEY+i,T(o.parameters.expires_in))),h(o.parameters,"id_token"))if(k=!1,n=M(o.parameters.id_token),n&&n.profile)I(n)?(u(e.IDTOKEN,o.parameters.id_token),i=t.loginResource?t.loginResource:t.clientId,_(i)||(r=w(e.TOKEN_KEYS)||"",u(e.TOKEN_KEYS,r+i+"|")),u(e.ACCESS_TOKEN_KEY+i,o.parameters.id_token),u(e.EXPIRATION_KEY+i,n.profile.exp)):(u(e.LOGIN_ERROR,"Nonce received: "+n.profile.nonce+" is not same as requested: "+w(e.NONCE_IDTOKEN)),n=null);else{const t="invalid id_token",n="Invalid id_token. id_token: "+o.parameters.id_token;o.parameters.error=t,o.parameters.error_description=n,u(e.ERROR,t),u(e.ERROR_DESCRIPTION,n)}}else{const t="Invalid_state",n="Invalid_state. state: "+o.stateResponse;o.parameters.error=t,o.parameters.error_description=n,u(e.ERROR,t),u(e.ERROR_DESCRIPTION,n)}u(e.RENEW_STATUS+i,a.Completed)},loginInProgress:()=>k,handleWindowCallback:F,_callBackMappedToRenewStates:A,_callBacksMappedToRenewStates:P}}!function(e){e[e.Error=0]="Error",e[e.Warn=1]="Warn",e[e.Info=2]="Info",e[e.Verbose=3]="Verbose"}(n||(n={})),function(e){e.LOGIN="LOGIN",e.RENEW_TOKEN="RENEW_TOKEN",e.UNKNOWN="UNKNOWN"}(r||(r={})),function(e){e.ID_TOKEN="id_token token",e.TOKEN="token"}(o||(o={})),function(e){e.Canceled="Canceled",e.Completed="Completed",e.InProgress="In Progress"}(a||(a={}));let s=t=>{u(e.STATE_RENEW,""),u(e.ERROR,""),u(e.ERROR_DESCRIPTION,""),_(t)&&(u(e.ACCESS_TOKEN_KEY+t,""),u(e.EXPIRATION_KEY+t,0))},l=e=>{if(g(e))return;let t=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(e);return!t||t.length<4?void 0:{header:t[1],JWSPayload:t[2],JWSSig:t[3]}},c=e=>({popUp:!1,instance:"https://login.microsoftonline.com/",loginResource:e.clientId,laodFrameTimeout:6e3,expireOffsetSeconds:300,navigateToLoginRequestUrl:!0,tenant:"common",redirectUri:window.location.href.split("?")[0].split("#")[0],callback:()=>{},...e}),d=e=>encodeURIComponent(e),E=(e,t)=>new RegExp("[\\?&]"+e+"=").test(t),p=(e,t)=>e.replace(new RegExp("(\\&"+t+"=)[^&]+"),"").replace(new RegExp("("+t+"=)[^&]+&"),"").replace(new RegExp("("+t+"=)[^&]+"),""),u=(e,n,r=!1)=>{if(r){let r=w(e)||"";t.setItem(e,r+n+"||")}else t.setItem(e,n)},_=t=>{let n=w(e.TOKEN_KEYS);return!g(n)&&n.indexOf(t+"|")>-1},R=e=>e.indexOf("#/")>-1?e.substring(e.indexOf("#/")+2):e.indexOf("#")>-1?e.substring(1):e,f=e=>{const t=O(R(e));return h(t,"error_description")||h(t,"access_token")||h(t,"id_token")},O=e=>{let t=/\+/g,n=/([^&=]+)=([^&]*)/g,r=e=>decodeURIComponent(e.replace(t," ")),o={},a=n.exec(e);for(;a;)o[r(a[1])]=r(a[2]),a=n.exec(e);return o},I=t=>{const n=w(e.NONCE_IDTOKEN);if(n)for(const e of n.split("||"))if(e===t.profile.nonce)return!0;return!1},N=e=>{if(e){let t=e.indexOf("|");if(t>-1&&t+1<e.length)return e.substring(t+1)}return""},T=e=>(e||(e=3599),K()+parseInt(e,10)),m=(e,t,n)=>{if(!t)return"";const r=["?response_type="+e,"client_id="+d(t.clientId)];n&&r.push("resource="+d(n)),r.push("redirect_uri="+d(t.redirectUri)),r.push("state="+d(t.state)),h(t,"slice")&&r.push("slice="+d(t.slice)),h(t,"extraQueryParameter")&&r.push(t.extraQueryParameter);const o=t.correlationId||S();return r.push("client-request-id="+d(o)),r.join("&")},S=()=>{let e=new Uint8Array(16);return crypto.getRandomValues(e),e[6]|=64,e[6]&=79,e[8]|=128,e[8]&=191,e=e.map(e=>{let t=e.toString(16);for(;t.length<2;)t="0"+t;return t}),e[0]+e[1]+e[2]+e[3]+"-"+e[4]+e[5]+"-"+e[6]+e[7]+"-"+e[8]+e[9]+"-"+e[10]+e[11]+e[12]+e[13]+e[14]+e[15]},w=e=>t.getItem(e),g=e=>!e||!e.length,h=(e,t)=>Object.hasOwnProperty.call(e,t),K=()=>Math.round(Date.now()/1e3);export{i as AuthenticationContext,s as clearCacheForResource};
//# sourceMappingURL=adal.modern.js.map
