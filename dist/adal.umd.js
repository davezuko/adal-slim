!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).adalAngular={})}(this,function(e){function t(){return(t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function r(e){var t=0;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(e){if("string"==typeof e)return n(e,void 0);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,void 0):void 0}}(e)))return function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(t=e[Symbol.iterator]()).next.bind(t)}var i;!function(e){e.TOKEN_KEYS="adal.token.keys",e.ACCESS_TOKEN_KEY="adal.access.token.key",e.EXPIRATION_KEY="adal.expiration.key",e.STATE_LOGIN="adal.state.login",e.STATE_RENEW="adal.state.renew",e.NONCE_IDTOKEN="adal.nonce.idtoken",e.SESSION_STATE="adal.session.state",e.USERNAME="adal.username",e.IDTOKEN="adal.idtoken",e.ERROR="adal.error",e.ERROR_DESCRIPTION="adal.error.description",e.LOGIN_REQUEST="adal.login.request",e.LOGIN_ERROR="adal.login.error",e.RENEW_STATUS="adal.token.renew.status"}(i||(i={}));var o,s,a=function(){function e(e){var t=window[e];return!!t&&(t.setItem("__test__","__test__"),"__test__"===t.getItem("__test__")&&(t.removeItem("__test__"),!t.getItem("__test__")))}return e("localStorage")?localStorage:e("sessionStorage")?sessionStorage:{getItem:function(){},setItem:function(){}}}();!function(e){e[e.Error=0]="Error",e[e.Warn=1]="Warn",e[e.Info=2]="Info",e[e.Verbose=3]="Verbose"}(s||(s={}));var c,l,d,u=((o={})[s.Error]="ERROR",o[s.Warn]="WARNING",o[s.Info]="INFO",o[s.Verbose]="VERBOSE",o),h=function(){function e(){this.pii=!1,this.level=s.Error}var t=e.prototype;return t.log=function(e,t,n,r){if(void 0===r&&(r=!1),(!r||this.pii)&&e<=this.level){var i=(new Date).toUTCString()+":"+(this.correlationId?this.correlationId+"-":"")+"1.0.17-"+u[e]+": "+t;n&&(i+="\nstack:\n"+n.stack),console.log(i)}},t.error=function(e,t){this.log(s.Error,e,t)},t.warn=function(e){this.log(s.Warn,e,null)},t.info=function(e){this.log(s.Info,e,null)},t.verbose=function(e){this.log(s.Verbose,e,null)},t.errorPii=function(e,t){this.log(s.Error,e,t,!0)},t.warnPii=function(e){this.log(s.Warn,e,null,!0)},t.infoPii=function(e){this.log(s.Info,e,null,!0)},t.verbosePii=function(e){this.log(s.Verbose,e,null,!0)},e}();!function(e){e.LOGIN="LOGIN",e.RENEW_TOKEN="RENEW_TOKEN",e.UNKNOWN="UNKNOWN"}(c||(c={})),function(e){e.ID_TOKEN="id_token token",e.TOKEN="token"}(l||(l={})),function(e){e.Canceled="Canceled",e.Completed="Completed",e.InProgress="In Progress"}(d||(d={}));var p="id_token";function g(e,t,n){if(void 0===n&&(n=!1),n){var r=_(e)||"";a.setItem(e,r+t+"||")}else a.setItem(e,t)}function _(e){return a.getItem(e)}function f(e){return e.indexOf("#/")>-1?e=e.substring(e.indexOf("#/")+2):e.indexOf("#")>-1&&(e=e.substring(1)),e}function E(e){var t,n=/\+/g,r=/([^&=]+)=([^&]*)/g,i=function(e){return decodeURIComponent(e.replace(n," "))},o={};for(t=r.exec(e);t;)o[i(t[1])]=i(t[2]),t=r.exec(e);return o}function R(e){return void 0===e||!e||0===e.length}function m(e,t){return!!e&&Object.hasOwnProperty.call(e,t)}function I(){return Math.round(Date.now()/1e3)}function T(){var e=window.crypto||window.msCrypto,t=new Uint8Array(16);return e.getRandomValues(t),t[6]|=64,t[6]&=79,t[8]|=128,t[8]&=191,(t=t.map(function(e){for(var t=e.toString(16);t.length<2;)t="0"+t;return t}))[0]+t[1]+t[2]+t[3]+"-"+t[4]+t[5]+"-"+t[6]+t[7]+"-"+t[8]+t[9]+"-"+t[10]+t[11]+t[12]+t[13]+t[14]+t[15]}e.Adal=function(){function e(e){if(this.logger=new h,this._activeRenewals={},this._loginInProgress=!1,this._acquireTokenInProgress=!1,this._renewStates=[],this._openedWindows=[],this._callBackMappedToRenewStates={},this._callBacksMappedToRenewStates={},this._requestType=c.LOGIN,this._urlContainsQueryStringParameter=function(e,t){return new RegExp("[\\?&]"+e+"=").test(t)},this._urlRemoveQueryStringParameter=function(e,t){var n=new RegExp("(\\&"+t+"=)[^&]+");return e=e.replace(n,""),n=new RegExp("("+t+"=)[^&]+&"),e=e.replace(n,""),n=new RegExp("("+t+"=)[^&]+"),e.replace(n,"")},this._loadFrameTimeout=function(e,t,n){var r=this;this.verbose("Set loading state to pending for: "+n),g(i.RENEW_STATUS+n,d.InProgress),this._loadFrame(e,t),setTimeout(function(){if(_(i.RENEW_STATUS+n)===d.InProgress){r.verbose("Loading frame has timed out after: "+r.config.loadFrameTimeout/1e3+" seconds for resource "+n);var e=r._activeRenewals[n];e&&r._callBackMappedToRenewStates[e]&&r._callBackMappedToRenewStates[e]("Token renewal operation failed due to timeout",null,"Token Renewal Failed"),g(i.RENEW_STATUS+n,d.Canceled)}},this.config.loadFrameTimeout)},this._addHintParameters=function(e){if(this._user&&this._user.profile)if(this._user.profile.sid&&-1!==e.indexOf("&prompt=none"))this._urlContainsQueryStringParameter("sid",e)||(e+="&sid="+encodeURIComponent(this._user.profile.sid));else if(this._user.profile.upn&&(this._urlContainsQueryStringParameter("login_hint",e)||(e+="&login_hint="+encodeURIComponent(this._user.profile.upn)),!this._urlContainsQueryStringParameter("domain_hint",e)&&this._user.profile.upn.indexOf("@")>-1)){var t=this._user.profile.upn.split("@");e+="&domain_hint="+encodeURIComponent(t[t.length-1])}return e},window._adalInstance)return window._adalInstance;this.config=t({popUp:!1,instance:"https://login.microsoftonline.com/",loginResource:e.clientId,laodFrameTimeout:6e3,expireOffsetSeconds:300,anonymousEndpoints:[],navigateToLoginRequestUrl:!0,tenant:"common",redirectUri:window.location.href.split("?")[0].split("#")[0],callback:function(){}},e),this.logger.correlationId=e.correlationId,window._adalInstance=this}var n=e.prototype;return n.login=function(){if(this._loginInProgress)this.logger.info("Login in progress");else{this._loginInProgress=!0;var e=T(),t=window.location.href;this.config.state=e,this._idTokenNonce=T(),this.logger.verbose("Expected state: "+e+" startPage:"+t),g(i.LOGIN_REQUEST,t),g(i.LOGIN_ERROR,""),g(i.STATE_LOGIN,e,!0),g(i.NONCE_IDTOKEN,this._idTokenNonce,!0),g(i.ERROR,""),g(i.ERROR_DESCRIPTION,"");var n=this._getNavigateUrl("id_token")+"&nonce="+encodeURIComponent(this._idTokenNonce);this.config.displayCall?this.config.displayCall(n):this.config.popUp?(g(i.STATE_LOGIN,""),this._renewStates.push(e),this.registerCallback(e,this.config.clientId,this.config.callback),this._loginPopup(n)):this.promptUser(n)}},n._openPopup=function(e,t,n,r){try{var i=window.innerWidth/2-n/2+window.screenX,o=window.innerHeight/2-r/2+window.screenY,s=window.open(e,t,"width="+n+", height="+r+", top="+o+", left="+i);return s.focus&&s.focus(),s}catch(e){return this.logger.warn("Error opening popup, "+e.message),this._loginInProgress=!1,this._acquireTokenInProgress=!1,null}},n._handlePopupError=function(e,t,n,r,o){this.logger.warn(r),g(i.ERROR,n),g(i.ERROR_DESCRIPTION,r),g(i.LOGIN_ERROR,o),t&&this._activeRenewals[t]&&(this._activeRenewals[t]=null),this._loginInProgress=!1,this._acquireTokenInProgress=!1,e&&e(r,null,n)},n._loginPopup=function(e,t,n){var r=this,i=this._openPopup(e,"login",483,600),o=n||this.config.callback;if(i){this._openedWindows.push(i);var s=this.config.redirectUri.split("#")[0],a=setInterval(function(){if(!i||i.closed||void 0===i.closed){var e="Popup Window closed by UI action/ Popup Window handle destroyed due to cross zone navigation in IE/Edge";return r._handlePopupError(o,t,"Popup Window closed",e,e),void clearInterval(a)}try{var n=i.location;if(-1!=encodeURI(n.href).indexOf(encodeURI(s)))return r.handleWindowCallback(n.hash),clearInterval(a),r._loginInProgress=!1,r._acquireTokenInProgress=!1,r.logger.info("Closing popup window"),r._openedWindows=[],void i.close()}catch(e){}},1)}else{var c="Popup Window is null. This can happen if you are using IE";this._handlePopupError(o,t,"Error opening popup",c,c)}},n.loginInProgress=function(){return this._loginInProgress},n._hasResource=function(e){var t=_(i.TOKEN_KEYS);return!R(t)&&t.indexOf(e+"|")>-1},n.getCachedToken=function(e){if(!this._hasResource(e))return null;var t=_(i.ACCESS_TOKEN_KEY+e),n=_(i.EXPIRATION_KEY+e);return n&&n>I()+this.config.expireOffsetSeconds?t:(g(i.ACCESS_TOKEN_KEY+e,""),g(i.EXPIRATION_KEY+e,0),null)},n.getCachedUser=function(){if(this._user)return this._user;var e=_(i.IDTOKEN);return this._user=this._createUser(e),this._user},n.registerCallback=function(e,t,n){var r=this;this._activeRenewals[t]=e,this._callBacksMappedToRenewStates[e]||(this._callBacksMappedToRenewStates[e]=[]),this._callBacksMappedToRenewStates[e].push(n),this._callBackMappedToRenewStates[e]||(this._callBackMappedToRenewStates[e]=function(n,i,o,s){r._activeRenewals[t]=null;for(var a=0;a<r._callBacksMappedToRenewStates[e].length;++a)try{r._callBacksMappedToRenewStates[e][a](n,i,o,s)}catch(o){r.logger.warn(o)}r._callBacksMappedToRenewStates[e]=null,r._callBackMappedToRenewStates[e]=null})},n._renewToken=function(e,t,n){void 0===n&&(n="token"),this.logger.info("renewToken is called for resource:"+e);var r=this._addAdalFrame("adalRenewFrame"+e),o=T()+"|"+e;this.config.state=o,this._renewStates.push(o),this.logger.verbose("Renew token Expected state: "+o);var s=this._urlRemoveQueryStringParameter(this._getNavigateUrl(n,e),"prompt");n===l.ID_TOKEN&&(this._idTokenNonce=T(),g(i.NONCE_IDTOKEN,this._idTokenNonce,!0),s+="&nonce="+encodeURIComponent(this._idTokenNonce)),s=this._addHintParameters(s+="&prompt=none"),this.registerCallback(o,e,t),this.logger.verbosePii("Navigate to:"+s),r.src="about:blank",this._loadFrameTimeout(s,"adalRenewFrame"+e,e)},n._renewIdToken=function(e,t){this.logger.info("renewIdToken is called");var n=this._addAdalFrame("adalIdTokenFrame"),r=T()+"|"+this.config.clientId;this._idTokenNonce=T(),g(i.NONCE_IDTOKEN,this._idTokenNonce,!0),this.config.state=r,this._renewStates.push(r),this.logger.verbose("Renew Idtoken Expected state: "+r);var o=t||this.config.clientId,s=this._urlRemoveQueryStringParameter(this._getNavigateUrl(t=t||"id_token",o),"prompt");s=this._addHintParameters(s+="&prompt=none"),s+="&nonce="+encodeURIComponent(this._idTokenNonce),this.registerCallback(r,this.config.clientId,e),this.logger.verbosePii("Navigate to:"+s),n.src="about:blank",this._loadFrameTimeout(s,"adalIdTokenFrame",this.config.clientId)},n._loadFrame=function(e,t){var n=this;this.logger.info("LoadFrame: "+t),setTimeout(function(){var r=n._addAdalFrame(t);""!==r.src&&"about:blank"!==r.src||(r.src=e,n._loadFrame(e,t))},500)},n.acquireToken=function(e,t){if(!e){var n="resource is required";return this.logger.warn(n),void t(n,null,n)}var r=this.getCachedToken(e);if(r)return this.logger.info("Token is already in cache for resource:"+e),void t(null,r,null);if(!(this._user||this.config.extraQueryParameter&&-1!==this.config.extraQueryParameter.indexOf("login_hint"))){var i="User login is required";return this.logger.warn(i),void t(i,null,i)}this._activeRenewals[e]?this.registerCallback(this._activeRenewals[e],e,t):(this._requestType=c.RENEW_TOKEN,e===this.config.clientId?this._user?(this.logger.verbose("renewing idtoken"),this._renewIdToken(t)):(this.logger.verbose("renewing idtoken and access_token"),this._renewIdToken(t,l.ID_TOKEN)):this._user?(this.logger.verbose("renewing access_token"),this._renewToken(e,t)):(this.logger.verbose("renewing idtoken and access_token"),this._renewToken(e,t,l.ID_TOKEN)))},n.acquireTokenPopup=function(e,t,n,r){if(this.ensureCanAcquireToken(e)){var i=T()+"|"+e;this.config.state=i,this._renewStates.push(i),this._requestType=c.RENEW_TOKEN,this.logger.verbose("Renew token Expected state: "+i);var o=this._urlRemoveQueryStringParameter(this._getNavigateUrl("token",e),"prompt");if(o+="&prompt=select_account",t&&(o+=t),n&&-1===o.indexOf("&claims"))o+="&claims="+encodeURIComponent(n);else if(n&&-1!==o.indexOf("&claims"))throw new Error("Claims cannot be passed as an extraQueryParameter");o=this._addHintParameters(o),this._acquireTokenInProgress=!0,this.logger.info("acquireToken interactive is called for the resource "+e),this.registerCallback(i,e,r),this._loginPopup(o,e,r)}},n.acquireTokenRedirect=function(e,t,n){if(this.ensureCanAcquireToken(e)){var r=T()+"|"+e;this.config.state=r,this.logger.verbose("Renew token Expected state: "+r);var o=this._urlRemoveQueryStringParameter(this._getNavigateUrl("token",e),"prompt");if(o+="&prompt=select_account",t&&(o+=t),n&&-1===o.indexOf("&claims"))o+="&claims="+encodeURIComponent(n);else if(n&&-1!==o.indexOf("&claims"))throw new Error("Claims cannot be passed as an extraQueryParameter");o=this._addHintParameters(o),this._acquireTokenInProgress=!0,this.logger.info("acquireToken interactive is called for the resource "+e),g(i.LOGIN_REQUEST,window.location.href),g(i.STATE_RENEW,r,!0),this.promptUser(o)}},n.ensureCanAcquireToken=function(e){var t;return e?this._user?this._acquireTokenInProgress&&(t="Acquire token interactive is already in progress"):t="User login is required":t="Resource is required",!t||(this.logger.warn(t),this.config.callback(t,null,t),!1)},n.promptUser=function(e){e?(this.logger.infoPii("Navigate to:"+e),window.location.replace(e)):this.logger.info("Navigate url is empty")},n.clearCache=function(){g(i.LOGIN_REQUEST,""),g(i.SESSION_STATE,""),g(i.STATE_LOGIN,""),g(i.STATE_RENEW,""),this._renewStates=[],g(i.NONCE_IDTOKEN,""),g(i.IDTOKEN,""),g(i.ERROR,""),g(i.ERROR_DESCRIPTION,""),g(i.LOGIN_ERROR,""),g(i.LOGIN_ERROR,"");var e=_(i.TOKEN_KEYS);if(!R(e)){e=e.split("|");for(var t=0;t<e.length&&""!==e[t];t++)g(i.ACCESS_TOKEN_KEY+e[t],""),g(i.EXPIRATION_KEY+e[t],0)}g(i.TOKEN_KEYS,"")},n.clearCacheForResource=function(e){g(i.STATE_RENEW,""),g(i.ERROR,""),g(i.ERROR_DESCRIPTION,""),this._hasResource(e)&&(g(i.ACCESS_TOKEN_KEY+e,""),g(i.EXPIRATION_KEY+e,0))},n.logOut=function(){var e;if(this.clearCache(),this._user=null,this.config.logOutUri)e=this.config.logOutUri;else{var t="";this.config.postLogoutRedirectUri&&(t="post_logout_redirect_uri="+encodeURIComponent(this.config.postLogoutRedirectUri)),e=this.config.instance+this.config.tenant+"/oauth2/logout?"+t}this.logger.infoPii("Logout navigate to: "+e),this.promptUser(e)},n.getUser=function(){if(this._user)return this._user;var e=_(i.IDTOKEN);return e?this._user=this._createUser(e):void 0},n._createUser=function(e){var t=this._extractIdToken(e);if(m(t,"aud"))return t.aud.toLowerCase()===this.config.clientId.toLowerCase()?{userName:t.upn||t.email,profile:t}:void this.logger.warn("IdToken has invalid aud field")},n.getLoginError=function(){return _(i.LOGIN_ERROR)},n.getRequestInfo=function(e){var t={valid:!1,parameters:{},stateMatch:!1,stateResponse:"",requestType:c.UNKNOWN},n=E(f(e));if(!n)return t;if(t.parameters=n,m(n,"error_description")||m(n,"access_token")||m(n,p)){if(t.valid=!0,!n.hasOwnProperty("state"))return this.logger.warn("No state returned"),t;if(this.logger.verbose("State: "+n.state),t.stateResponse=n.state,this._matchState(t))return t;if(!t.stateMatch&&window.parent){t.requestType=this._requestType;for(var i,o=r(this._renewStates);!(i=o()).done;)if(i.value===t.stateResponse){t.stateMatch=!0;break}}}return t},n._matchNonce=function(e){var t=_(i.NONCE_IDTOKEN);if(t)for(var n,o=r(t.split("||"));!(n=o()).done;)if(n.value===e.profile.nonce)return!0;return!1},n._matchState=function(e){var t=_(i.STATE_LOGIN);if(t)for(var n,o=r(t.split("||"));!(n=o()).done;)if(n.value===e.stateResponse)return e.requestType=c.LOGIN,e.stateMatch=!0,!0;var s=_(i.STATE_RENEW);if(s)for(var a,l=r(s.split("||"));!(a=l()).done;)if(a.value===e.stateResponse)return e.requestType=c.RENEW_TOKEN,e.stateMatch=!0,!0;return!1},n.saveTokenFromHash=function(e){this.logger.info("State status:"+e.stateMatch+"; Request type:"+e.requestType),g(i.ERROR,""),g(i.ERROR_DESCRIPTION,"");var t,n=function(e){if(e){var t=e.indexOf("|");if(t>-1&&t+1<e.length)return e.substring(t+1)}return""}(e.stateResponse);e.parameters.hasOwnProperty("error_description")?(this.logger.infoPii("Error :"+e.parameters.error+"; Error description:"+e.parameters.error_description),g(i.ERROR,e.parameters.error),g(i.ERROR_DESCRIPTION,e.parameters.error_description),e.requestType===c.LOGIN&&(this._loginInProgress=!1,g(i.LOGIN_ERROR,e.parameters.error_description))):e.stateMatch?(this.logger.info("State is right"),e.parameters.hasOwnProperty("session_state")&&g(i.SESSION_STATE,e.parameters.session_state),e.parameters.hasOwnProperty("access_token")&&(this.logger.info("Fragment has access token"),this._hasResource(n)||(t=_(i.TOKEN_KEYS)||"",g(i.TOKEN_KEYS,t+n+"|")),g(i.ACCESS_TOKEN_KEY+n,e.parameters.access_token),g(i.EXPIRATION_KEY+n,this._expiresIn(e.parameters.expires_in))),e.parameters.hasOwnProperty(p)&&(this._loginInProgress=!1,this._user=this._createUser(e.parameters[p]),this._user&&this._user.profile?this._matchNonce(this._user)?(g(i.IDTOKEN,e.parameters[p]),this._hasResource(n=this.config.loginResource?this.config.loginResource:this.config.clientId)||(t=_(i.TOKEN_KEYS)||"",g(i.TOKEN_KEYS,t+n+"|")),g(i.ACCESS_TOKEN_KEY+n,e.parameters[p]),g(i.EXPIRATION_KEY+n,this._user.profile.exp)):(g(i.LOGIN_ERROR,"Nonce received: "+this._user.profile.nonce+" is not same as requested: "+_(i.NONCE_IDTOKEN)),this._user=null):(e.parameters.error="invalid id_token",e.parameters.error_description="Invalid id_token. id_token: "+e.parameters[p],g(i.ERROR,"invalid id_token"),g(i.ERROR_DESCRIPTION,"Invalid id_token. id_token: "+e.parameters[p])))):(e.parameters.error="Invalid_state",e.parameters.error_description="Invalid_state. state: "+e.stateResponse,g(i.ERROR,"Invalid_state"),g(i.ERROR_DESCRIPTION,"Invalid_state. state: "+e.stateResponse)),g(i.RENEW_STATUS+n,d.Completed)},n.getResourceForEndpoint=function(e){if(this.config&&this.config.anonymousEndpoints)for(var t=0;t<this.config.anonymousEndpoints.length;t++)if(e.indexOf(this.config.anonymousEndpoints[t])>-1)return null;if(this.config&&this.config.endpoints)for(var n in this.config.endpoints)if(e.indexOf(n)>-1)return this.config.endpoints[n];return e.indexOf("http://")>-1||e.indexOf("https://")>-1?this._getHostFromUri(e)===this._getHostFromUri(this.config.redirectUri)?this.config.loginResource:null:this.config.loginResource},n._getHostFromUri=function(e){return String(e).replace(/^(https?:)\/\//,"").split("/")[0]},n.handleWindowCallback=function(e){if(null==e&&(e=window.location.hash),function(e){var t=E(f(e));return m(t,"error_description")||m(t,"access_token")||m(t,p)}(e)){var t=null,n=!1;this._openedWindows.length>0&&this._openedWindows[this._openedWindows.length-1].opener&&this._openedWindows[this._openedWindows.length-1].opener._adalInstance?(t=this._openedWindows[this._openedWindows.length-1].opener._adalInstance,n=!0):window.parent&&window.parent._adalInstance&&(t=window.parent._adalInstance);var r,o,s,a=t.getRequestInfo(e);r=n||window.parent!==window?t._callBackMappedToRenewStates[a.stateResponse]:t.config.callback,t.saveTokenFromHash(a),a.requestType===c.RENEW_TOKEN&&window.parent?(window.parent!==window?t.logger.verbose("Window is in iframe, acquiring token silently"):t.logger.verbose("acquiring token interactive in progress"),o=a.parameters.access_token||a.parameters[p],s="access_token"):a.requestType===c.LOGIN&&(o=a.parameters[p],s=p);var l=a.parameters.error_description,d=a.parameters.error;try{r&&r(l,o,d,s)}catch(e){t.logger.error("Error occurred in user defined callback function: "+e)}window.parent!==window||n||(t.config.navigateToLoginRequestUrl?window.location.href=_(i.LOGIN_REQUEST):window.location.hash="")}},n._getNavigateUrl=function(e,t){var n=this.config.instance+this.config.tenant+"/oauth2/authorize"+this._serialize(e,this.config,t)+"&x-client-SKU=Js&x-client-Ver=1.0.17";return this.logger.info("Navigate url:"+n),n},n._extractIdToken=function(e){var t=this._decodeJwt(e);if(t)try{var n=this._base64DecodeStringUrlSafe(t.JWSPayload);return n?JSON.parse(n):void this.logger.info("The returned id_token could not be base64 url safe decoded.")}catch(e){this.logger.error("The returned id_token could not be decoded",e)}},n._base64DecodeStringUrlSafe=function(e){return e=e.replace(/-/g,"+").replace(/_/g,"/"),decodeURIComponent(escape(window.atob(e)))},n._decodeJwt=function(e){if(R(e))return null;var t=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(e);return!t||t.length<4?(this.logger.warn("The returned id_token is not parseable."),null):{header:t[1],JWSPayload:t[2],JWSSig:t[3]}},n._convertUrlSafeToRegularBase64EncodedString=function(e){return e.replace("-","+").replace("_","/")},n._serialize=function(e,t,n){var r=[];if(null!==t){r.push("?response_type="+e),r.push("client_id="+encodeURIComponent(t.clientId)),n&&r.push("resource="+encodeURIComponent(n)),r.push("redirect_uri="+encodeURIComponent(t.redirectUri)),r.push("state="+encodeURIComponent(t.state)),t.hasOwnProperty("slice")&&r.push("slice="+encodeURIComponent(t.slice)),t.hasOwnProperty("extraQueryParameter")&&r.push(t.extraQueryParameter);var i=t.correlationId?t.correlationId:T();r.push("client-request-id="+encodeURIComponent(i))}return r.join("&")},n._expiresIn=function(e){return e||(e=3599),I()+parseInt(e,10)},n._addAdalFrame=function(e){if(e){this.logger.info("Add adal frame to document:"+e);var t=document.getElementById(e);if(!t){if(document.createElement&&document.documentElement&&(window.opera||-1===window.navigator.userAgent.indexOf("MSIE 5.0"))){var n=document.createElement("iframe");n.setAttribute("id",e),n.setAttribute("aria-hidden","true"),n.style.visibility="hidden",n.style.position="absolute",n.style.width=n.style.height=n.borderWidth="0px",t=document.getElementsByTagName("body")[0].appendChild(n)}else document.body&&document.body.insertAdjacentHTML&&document.body.insertAdjacentHTML("beforeEnd",'<iframe name="'+e+'" id="'+e+'" style="display:none"></iframe>');window.frames&&window.frames[e]&&(t=window.frames[e])}return t}},e}()});
//# sourceMappingURL=adal.umd.js.map
